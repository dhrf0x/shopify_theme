{%- comment -%}
  Barra de Anuncios v8.0 — WF Urban Muscle
  Arquitectura de BLOCKS (patrón nativo Shopify)
  Ticker horizontal continuo — translateX seamless loop
  Subir a: sections/announcement-bar.liquid
{%- endcomment -%}

{%- comment -%}── Visibilidad ──{%- endcomment -%}
{%- assign _vis     = section.settings.ann_visibility | default: 'all' -%}
{%- assign _enabled = section.settings.show_bar -%}
{%- assign _show    = false -%}
{%- if _vis == 'all' or _vis == blank or _vis == nil -%}{%- assign _show = true -%}
{%- elsif _vis == 'home' and template == 'index' -%}{%- assign _show = true -%}
{%- elsif _vis == 'not_home' and template != 'index' -%}{%- assign _show = true -%}
{%- endif -%}
{%- if _enabled == false -%}{%- assign _show = false -%}{%- endif -%}

{%- assign _active_blocks = 0 -%}
{%- for block in section.blocks -%}
  {%- if block.settings.text != blank -%}{%- assign _active_blocks = _active_blocks | plus: 1 -%}{%- endif -%}
{%- endfor -%}

{%- if _show and _active_blocks > 0 -%}
{%- assign _sid   = section.id -%}
{%- assign _bg    = section.settings.background_color | default: '#cc0000' -%}
{%- assign _color = section.settings.text_color       | default: '#ffffff' -%}
{%- assign _size  = section.settings.font_size        | default: 13 -%}
{%- assign _speed = section.settings.scroll_speed     | default: 22 -%}

<section
  class="wf-ann-bar wf-ann-bar--{{ _sid }}"
  style="--ann-bg: {{ _bg }}; --ann-color: {{ _color }}; --ann-size: {{ _size }}px; --ann-speed: {{ _speed }}s;"
  aria-label="Anuncios">

  <div class="wf-ann-bar__track">
    {%- for repeat in (1..2) -%}
      <div class="wf-ann-bar__group" aria-hidden="{% if repeat == 2 %}true{% else %}false{% endif %}">
        {%- for block in section.blocks -%}
          {%- assign msg = block.settings.text | strip -%}
          {%- if msg != blank -%}
            {%- if block.settings.link != blank -%}
              <a href="{{ block.settings.link }}" class="wf-ann-bar__item" {{ block.shopify_attributes }}>
                <span class="wf-ann-bar__sep" aria-hidden="true">✦</span>{{ msg }}
              </a>
            {%- else -%}
              <span class="wf-ann-bar__item" {{ block.shopify_attributes }}>
                <span class="wf-ann-bar__sep" aria-hidden="true">✦</span>{{ msg }}
              </span>
            {%- endif -%}
          {%- endif -%}
        {%- endfor -%}
      </div>
    {%- endfor -%}
  </div>

</section>

<style>
.wf-ann-bar--{{ _sid }} {
  background: var(--ann-bg);
  color: var(--ann-color);
  font-size: var(--ann-size);
  width: 100%;
  min-height: 38px;
  display: flex;
  align-items: center;
  overflow: hidden;
  position: relative;
  z-index: 10;
  font-weight: 600;
  letter-spacing: 0.04em;
  /* Fade en bordes */
  -webkit-mask-image: linear-gradient(to right, transparent 0%, black 4%, black 96%, transparent 100%);
  mask-image: linear-gradient(to right, transparent 0%, black 4%, black 96%, transparent 100%);
}

/* Track: contiene 2 copias y se desplaza */
.wf-ann-bar--{{ _sid }} .wf-ann-bar__track {
  display: flex;
  align-items: center;
  white-space: nowrap;
  animation: wfTicker{{ _sid }} var(--ann-speed) linear infinite;
  will-change: transform;
}

/* Pausa al hover */
.wf-ann-bar--{{ _sid }}:hover .wf-ann-bar__track {
  animation-play-state: paused;
}

/* Grupo: una copia de los mensajes */
.wf-ann-bar--{{ _sid }} .wf-ann-bar__group {
  display: inline-flex;
  align-items: center;
  flex-shrink: 0;
}

/* Item individual */
.wf-ann-bar--{{ _sid }} .wf-ann-bar__item {
  display: inline-flex;
  align-items: center;
  gap: 0.6em;
  padding: 8px 2em;
  color: inherit;
  text-decoration: none;
  transition: opacity 0.2s;
}
.wf-ann-bar--{{ _sid }} a.wf-ann-bar__item:hover {
  opacity: 0.8;
  text-decoration: underline dotted;
}

.wf-ann-bar--{{ _sid }} .wf-ann-bar__sep {
  opacity: 0.6;
  font-size: 0.65em;
}

/* El ticker desplaza exactamente el 50% (una copia) para loop perfecto */
@keyframes wfTicker{{ _sid }} {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}
</style>

{%- endif -%}

{% schema %}
{
  "name": "Barra de Anuncios",
  "max_blocks": 5,
  "settings": [
    {
      "type": "header", "content": "— Activación —"
    },
    {
      "type": "checkbox", "id": "show_bar", "label": "Activar barra", "default": true
    },
    {
      "type": "select", "id": "ann_visibility", "label": "Mostrar en", "default": "all",
      "options": [
        { "value": "all",      "label": "Todas las páginas" },
        { "value": "home",     "label": "Solo inicio" },
        { "value": "not_home", "label": "Todas excepto inicio" }
      ]
    },
    {
      "type": "header", "content": "— Estilo —"
    },
    {
      "type": "color", "id": "background_color", "label": "Fondo",  "default": "#cc0000"
    },
    {
      "type": "color", "id": "text_color",        "label": "Texto",  "default": "#ffffff"
    },
    {
      "type": "range", "id": "font_size",
      "label": "Tamaño fuente", "min": 10, "max": 18, "step": 1, "unit": "px", "default": 13
    },
    {
      "type": "range", "id": "scroll_speed",
      "label": "Velocidad (+ lento = número mayor)", "min": 10, "max": 40, "step": 2, "unit": "s", "default": 22
    }
  ],
  "blocks": [
    {
      "type": "message",
      "name": "Anuncio",
      "settings": [
        {
          "type": "text", "id": "text", "label": "Mensaje"
        },
        {
          "type": "url", "id": "link", "label": "Enlace (opcional)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Barra de Anuncios",
      "blocks": [
        { "type": "message", "settings": { "text": "✦ Envío gratis en pedidos mayores a $999" } },
        { "type": "message", "settings": { "text": "Nuevos drops disponibles" } },
        { "type": "message", "settings": { "text": "Usa el cupón WFURBAN10 en tu primer compra" } }
      ]
    }
  ]
}
{% endschema %}
