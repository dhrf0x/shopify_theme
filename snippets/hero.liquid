{% if snippet_instance.settings.section_identifier != blank %}
  {% assign section_id = snippet_instance.settings.section_identifier %}
{% else %}
  {%- capture section_id -%} section-{{-snippet_instance.id-}} {%- endcapture -%}
{% endif %}

{% if snippet_instance.settings.enable_custom_styles %}
  {% include 'section-styles', instance_settings: snippet_instance.settings %}
{% endif %}

{% assign bg_image = snippet_instance.settings.background_image %}
{% assign bg_image_style = snippet_instance.settings.background_image_style %}
{% assign video_url = snippet_instance.settings.video_url %}
{% assign has_video = false %}
{% assign video_id = '' %}
{% assign video_type = '' %}

{% if video_url != blank %}
  {% assign has_video = true %}
  {% if video_url contains 'youtube.com' or video_url contains 'youtu.be' %}
    {% assign video_type = 'youtube' %}
    {% if video_url contains 'v=' %}
      {% assign video_id = video_url | split: 'v=' | last | split: '&' | first %}
    {% elsif video_url contains 'youtu.be/' %}
      {% assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first %}
    {% endif %}
  {% elsif video_url contains 'vimeo.com' %}
    {% assign video_type = 'vimeo' %}
    {% assign video_id = video_url | split: 'vimeo.com/' | last | split: '?' | first %}
  {% endif %}
{% endif %}

{% if bg_image != blank and bg_image_style == 'cover' and has_video == false %}
  {% assign lazyload = 'lazyload' %}
{% endif %}

{%- capture section_attributes -%}
  {% if snippet_type == 'section' %}
    data-section-id="{{ snippet_instance.id }}" data-section-type="hero"
  {% else %}
    data-block-id="{{ snippet_instance.id }}" data-block-type="hero"
  {% endif %}
{%- endcapture -%}

{% unless snippet_instance.settings.full_height %}
  <style>
  #{{section_id}} .content-section {
    min-height: {{ snippet_instance.settings.mobile_height | append: 'px' }};
  }
  @media print, screen and (min-width: 1024px) {
    #{{section_id}} .content-section {
      min-height: {{ snippet_instance.settings.desktop_height | append: 'px' }};
    }
  }
  </style>
{% endunless %}

{% if snippet_instance.settings.parallax and snippet_instance.settings.enable_custom_styles %}
  {% assign parallax_class = 'section__content_parallax' %}
{% endif %}

{% assign glass_blur = snippet_instance.settings.glass_blur | default: 16 %}
{% assign enable_glass = snippet_instance.settings.enable_glass_overlay %}

<div id="{{section_id}}" class="section {{ parallax_class }}">

  <div {{ section_attributes }}
    class="{{ lazyload }} content-section hero-section section__background {% if snippet_instance.settings.full_height %}hero-section_full-screen{% endif %} {% if has_video %}hero-has-video{% endif %}"
    {% if bg_image != blank and bg_image_style == 'cover' and snippet_instance.settings.enable_custom_styles and has_video == false %}
      data-bgset="{% include 'bgset', image: bg_image %}"
      data-sizes="auto"
      data-parent-fit="cover"
    {% endif %}>

    {% comment %} Video Background {% endcomment %}
    {% if has_video %}
      <div class="hero-video-bg" aria-hidden="true">
        {% if video_type == 'youtube' %}
          <iframe
            class="hero-video-iframe"
            src="https://www.youtube-nocookie.com/embed/{{ video_id }}?autoplay=1&mute=1&loop=1&playlist={{ video_id }}&controls=0&showinfo=0&rel=0&iv_load_policy=3&modestbranding=1&playsinline=1"
            frameborder="0"
            allow="autoplay; fullscreen"
            allowfullscreen>
          </iframe>
        {% elsif video_type == 'vimeo' %}
          <iframe
            class="hero-video-iframe"
            src="https://player.vimeo.com/video/{{ video_id }}?autoplay=1&muted=1&loop=1&background=1&controls=0"
            frameborder="0"
            allow="autoplay; fullscreen"
            allowfullscreen>
          </iframe>
        {% endif %}
        {% comment %} Image fallback shown before video loads {% endcomment %}
        {% if bg_image != blank %}
          <div class="hero-video-poster" style="background-image: url('{{ bg_image | img_url: '2000x' }}');"></div>
        {% endif %}
      </div>
    {% endif %}

    {% comment %} Darkening overlay {% endcomment %}
    <div class="background_darken"></div>

    {% comment %} Hero Content {% endcomment %}

    {% case snippet_instance.settings.text_width %}
      {% when '1-2' %}
        {% assign text_layout = 'medium-6 large-6 columns' %}
        {% if snippet_instance.settings.alignment == 'right' %}
          {% assign text_position = 'medium-push-6 large-push-6' %}
        {% endif %}
      {% when '1-3' %}
        {% assign text_layout = 'medium-4 large-4 columns' %}
        {% if snippet_instance.settings.alignment == 'right' %}
          {% assign text_position = 'medium-push-8 large-push-8' %}
        {% endif %}
      {% when '2-3' %}
        {% assign text_layout = 'medium-8 large-8 columns' %}
        {% if snippet_instance.settings.alignment == 'right' %}
          {% assign text_position = 'medium-push-4 large-push-4' %}
        {% endif %}
      {% when '3-4' %}
        {% assign text_layout = 'medium-9 large-9 columns' %}
        {% if snippet_instance.settings.alignment == 'right' %}
          {% assign text_position = 'medium-push-3 large-push-3' %}
        {% endif %}
    {% endcase %}

    <div class="content-section__inner row hero__wrap hero__wrap_{{ snippet_instance.settings.alignment }} {% if snippet_instance.settings.mobile_centered %}hero_mobile-centered{% endif %} js-animate-appear-show">
      <div class="{{ text_layout }} {{ text_position }} hero__content text-{{snippet_instance.settings.text_alignment}}">

        {% if enable_glass %}
        <div class="hero-glass-card" style="--glass-blur: {{ glass_blur }}px;">
        {% endif %}

          {% unless snippet_instance.settings.title == blank %}
            <h2 class="hero__title section__title-style">
              {{ snippet_instance.settings.title | escape }}
            </h2>
          {% endunless %}

          {% unless snippet_instance.settings.text == blank %}
            <div class="rte hero__text section__text-style">
              {{ snippet_instance.settings.text }}
            </div>
          {% endunless %}

          <div class="hero__btns">
            {% if snippet_type == 'section' %}
              {% for block in snippet_instance.blocks %}
                {% if block.settings.btn_link != blank %}
                  {% assign btn_id = block.id %}
                  {% include 'button-style', button_id: btn_id, btn_bg_color: block.settings.btn_bg_color, btn_style: block.settings.btn_style, btn_text_color: block.settings.btn_text_color %}
                  <a id="button-{{ btn_id }}" {{ block.shopify_attributes }} href="{{ block.settings.btn_link }}" class="button {% if block.settings.btn_style == 'hollow' %}hollow{% endif %}" style="{{ btn_style_css | strip_newlines }}">{{ block.settings.btn_text }}</a>
                {% endif %}
              {% endfor %}
            {% endif %}
          </div>

        {% if enable_glass %}
        </div>
        {% endif %}

      </div>
    </div>

    {% comment %} Scroll indicator {% endcomment %}
    {% if snippet_instance.settings.full_height %}
    <div class="hero-scroll-indicator" aria-hidden="true">
      <div class="hero-scroll-dot"></div>
    </div>
    {% endif %}

  </div>
</div>
